#!/usr/bin/env node

const slack = require('../slack')
const airtable = require('../airtable')
const utils = require('../utils')

sendTaskManagementButton()

async function sendTaskManagementButton() {
  // get everyone who is active and has the slack reminder for task mgmt
  // check box enabled
  const people = await airtable.getRecordsFromView('People', { 
    view: 'All People',
    filterByFormula: `IF({Active Status}='Active', IF({Send Slack Reminders for Task Management}=1, TRUE(), FALSE()), FALSE())`
  })
  
  for (const person of people) {
    slack.sendPrivateMessage({
      channel: person.get('Slack User ID'),
      attachments: [
        {
          title: ':wave: Manage your tasks here!',
          text: 'Use the button below to get a head start on next week. Quickly update the statuses of your tasks and easily move tasks to next week if you need more time!',
          callback_id: `${person.get('Name')}`,
          actions: [
            {
              name: 'manage_tasks',
              text: 'Manage Tasks',
              type: 'button',
              value: `${person.get('Slack User ID')}`
            }
          ]
        }
      ]
    })
  }
}
